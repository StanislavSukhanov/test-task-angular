(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{RsyV:function(t,e,s){"use strict";s.r(e),s.d(e,"MainModule",function(){return ot});var i=s("tyNb"),r=s("XNiG"),n=s("Kj3r"),a=s("/uUt"),o=s("vkgz"),l=s("fXoL"),h=s("2Vo4"),c=s("AytR"),u=s("lJxs"),p=s("tk/3");const g=c.a.baseUrl,d=t=>t.pipe(Object(u.a)(t=>t.result));let m=(()=>{class t{constructor(t){this.http=t}getUserDetails(){return this.http.get(g+"/v1/user/current").pipe(d)}updateUserDetails(t){return this.http.put(g+"/v1/user/profile",t).pipe(d)}updateUserPhoto(t){return this.http.post(g+"/v1/user/profile/image",t).pipe(d)}deleteUserPhoto(){return this.http.delete(g+"/v1/user/profile/image")}setUserLocation(t){return this.http.put(g+"/v1/user/location",t).pipe(d)}searchUsers(t){return this.http.get(`${g}/v1/user/search${t}`).pipe(Object(u.a)(t=>t.result))}getAllUsers(){return this.http.get(g+"/v1/user").pipe(Object(u.a)(t=>t.result))}getUserById(t){return this.http.get(`${g}/v1/user/${t}`).pipe(Object(u.a)(t=>t.result))}logOut(){return this.http.post(g+"/v1/user/logout",{})}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(p.b))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),b=(()=>{class t{constructor(t){this.apiService=t,this.usersList=new h.a(null),this.userList$=this.usersList.asObservable()}get usersValue(){return this.usersList.value}getUsers(t){this.apiService.searchUsers(t).pipe(Object(o.a)(t=>{this.usersList.next(t)})).subscribe()}getAllUsers(){this.apiService.getAllUsers().pipe(Object(o.a)(t=>{this.usersList.next(t)})).subscribe()}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(m))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var _=s("wZkO"),f=s("kmnG"),v=s("qFsG"),k=s("ofXK"),y=s("bTqV"),S=s("NFeN");function M(t,e){if(1&t){const t=l.Pb();l.Ob(0,"button",12),l.Vb("click",function(){l.ic(t);const e=l.Xb();return l.hc(13).value="",e.searchUsers("")}),l.Ob(1,"mat-icon"),l.pc(2,"close"),l.Nb(),l.Nb()}}const x=function(){return["/map"]},C=function(){return["/list"]},O=function(){return["/profile"]};let I=(()=>{class t{constructor(t){this.searchUsersService=t,this.searchSubject$=new r.a,this.destroy$=new r.a}ngOnInit(){this.searchSubject$.pipe(Object(n.a)(300),Object(a.a)(),Object(o.a)(t=>{this.searchUsersService.getUsers("?searchString="+t)})).subscribe()}ngOnDestroy(){this.destroy$.next()}searchUsers(t){this.searchSubject$.next(t)}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(b))},t.\u0275cmp=l.Db({type:t,selectors:[["app-main-layout"]],decls:19,vars:11,consts:[[1,"pt-16","mb-100"],["mat-tab-nav-bar","",3,"backgroundColor"],["mat-tab-link","","routerLinkActive","",3,"active","routerLink"],["rla","routerLinkActive"],["rla2","routerLinkActive"],[1,"header-right","pr-24"],[1,"search","mr-40"],["matInput","","type","text",3,"input"],["searchInput",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["mat-flat-button","","routerLinkActive","","role","link",3,"routerLink","color"],["rlaButton","routerLinkActive"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"]],template:function(t,e){if(1&t){const t=l.Pb();l.Ob(0,"header",0),l.Ob(1,"nav",1),l.Ob(2,"a",2,3),l.pc(4,"Map"),l.Nb(),l.Ob(5,"a",2,4),l.pc(7,"List"),l.Nb(),l.Nb(),l.Ob(8,"div",5),l.Ob(9,"mat-form-field",6),l.Ob(10,"mat-label"),l.pc(11,"Search"),l.Nb(),l.Ob(12,"input",7,8),l.Vb("input",function(){l.ic(t);const s=l.hc(13);return e.searchUsers(s.value)}),l.Nb(),l.oc(14,M,3,0,"button",9),l.Nb(),l.Ob(15,"button",10,11),l.pc(17,"Profile "),l.Nb(),l.Nb(),l.Nb(),l.Kb(18,"router-outlet")}if(2&t){const t=l.hc(3),e=l.hc(6),s=l.hc(13),i=l.hc(16);l.zb(1),l.cc("backgroundColor","blue"),l.zb(1),l.cc("active",t.isActive)("routerLink",l.dc(8,x)),l.zb(3),l.cc("active",e.isActive)("routerLink",l.dc(9,C)),l.zb(9),l.cc("ngIf",s.value),l.zb(1),l.cc("routerLink",l.dc(10,O))("color",i.isActive?"primary":"basic")}},directives:[_.b,i.e,_.a,i.d,f.c,f.f,v.a,k.j,y.a,i.c,i.g,f.g,S.a],styles:["header[_ngcontent-%COMP%]{position:relative}.header-right[_ngcontent-%COMP%]{position:absolute;right:0;top:16px;z-index:5}.header-right[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:200px}"],changeDetection:0}),t})();var w=s("1G5W");const L="https://hajiri.co/uploads/no_image.jpg",P=[{lat:50.431773,lon:30.424636},{lat:50.431773,lon:30.424636},{lat:50.459637,lon:30.428946},{lat:50.463541,lon:30.454595},{lat:50.477655,lon:30.534808},{lat:50.464036,lon:30.553635},{lat:50.461687,lon:30.570799},{lat:50.456198,lon:30.621799},{lat:50.38017,lon:30.568871},{lat:50.37816,lon:30.603209}],z=t=>{const e=parseInt(t.toString(),16);return P[e%10]};var N=s("1/+G");let U=(()=>{class t{constructor(t,e,s){this.apiService=t,this.storageService=e,this.router=s,this.currentUser$=new h.a(null)}get userData(){return this.currentUser$.asObservable()}get userValue(){return this.currentUser$.value}setUser(t){this.currentUser$.next(t)}loadUserData(){this.apiService.getUserDetails().pipe(Object(o.a)(t=>this.setUser(t))).subscribe(t=>{t.lon&&t.lat||this.setLocation(t.id)})}updateUserData(t){this.apiService.updateUserDetails(t).pipe(Object(o.a)(t=>this.setUser(t))).subscribe()}updateUserPhoto(t){this.apiService.updateUserPhoto(t).pipe(Object(o.a)(t=>this.setUser(t))).subscribe()}deletePhoto(){this.apiService.deleteUserPhoto().pipe(Object(o.a)(()=>{const t=this.userValue;delete t.image,this.setUser(t)})).subscribe()}setLocation(t){navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{this.apiService.setUserLocation({lat:t.coords.latitude,lon:t.coords.longitude}).pipe(Object(o.a)(t=>this.setUser(t))).subscribe()},()=>{this.apiService.setUserLocation(z(t)).pipe(Object(o.a)(t=>this.setUser(t))).subscribe()},{maximumAge:6e4,timeout:5e3,enableHighAccuracy:!0}):this.apiService.setUserLocation(z(t)).pipe(Object(o.a)(t=>this.setUser(t))).subscribe()}logOut(){return this.apiService.logOut().subscribe(t=>{this.storageService.remove("token"),this.setUser(null),this.router.navigate(["auth"])})}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(m),l.Sb(N.a),l.Sb(i.b))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var A=s("3Pt+");let D=(()=>{class t{constructor(t){this.fb=t}getProfileForm(){return this.fb.group({firstName:[null],lastName:[null],gender:[null],email:[null,[A.k.required]]})}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(A.b))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var E=s("Wp6s");function $(t,e){if(1&t){const t=l.Pb();l.Ob(0,"div",4),l.Ob(1,"input",5,6),l.Vb("change",function(e){return l.ic(t),l.Xb().handleUpload(e.target.files)}),l.Nb(),l.Ob(3,"button",7),l.Vb("click",function(){l.ic(t);const e=l.hc(2);return l.Xb().focus(e)}),l.pc(4,"Upload photo"),l.Nb(),l.Ob(5,"button",8),l.Vb("click",function(){return l.ic(t),l.Xb().delete()}),l.pc(6,"Delete photo"),l.Nb(),l.Nb()}}let T=(()=>{class t{constructor(){this.updatePhoto=new l.n,this.deletePhoto=new l.n,this.fallbackPhotoUrl=L}update(){this.updatePhoto.emit()}delete(){this.deletePhoto.emit()}focus(t){t.click()}handleUpload(t){if(t&&t.length>0){const e=new FormData;e.append("image",t[0]),this.updatePhoto.emit(e)}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Db({type:t,selectors:[["app-user-photo"]],inputs:{photoUrl:"photoUrl",enableSend:"enableSend"},outputs:{updatePhoto:"updatePhoto",deletePhoto:"deletePhoto"},decls:4,vars:2,consts:[[1,"flex","flex-column","align-center"],[1,"image-container","mb-32"],["mat-card-image","","alt","user photo",3,"src"],["class","flex flex-row space-between",4,"ngIf"],[1,"flex","flex-row","space-between"],["id","fileInput","type","file",2,"display","none",3,"change"],["ref",""],["mat-flat-button","","color","primary",2,"margin-right","8px",3,"click"],["mat-flat-button","","color","warn",3,"click"]],template:function(t,e){1&t&&(l.Ob(0,"div",0),l.Ob(1,"mat-card",1),l.Kb(2,"img",2),l.Nb(),l.oc(3,$,7,0,"div",3),l.Nb()),2&t&&(l.zb(2),l.cc("src",e.photoUrl||e.fallbackPhotoUrl,l.jc),l.zb(1),l.cc("ngIf",e.enableSend))},directives:[E.a,E.c,k.j,y.a],styles:[".image-container[_ngcontent-%COMP%]{max-width:250px;max-height:250px}"],changeDetection:0}),t})();var j=s("QibW");let Z=(()=>{class t{constructor(t,e,s){this.userDataService=t,this.formService=e,this.users=s,this.user$=this.userDataService.userData,this.destroy$=new r.a,this.updateForm=this.formService.getProfileForm()}ngOnInit(){this.user$.pipe(Object(w.a)(this.destroy$)).subscribe(t=>{t&&(this.updateForm.patchValue(t),this.userPhoto=t.image||"")})}ngOnDestroy(){this.destroy$.next()}submitForm(){this.userDataService.updateUserData(this.updateForm.value)}deletePhoto(){this.userDataService.deletePhoto()}updatePhoto(t){this.userDataService.updateUserPhoto(t),this.users.getAllUsers()}logOut(){this.userDataService.logOut()}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(U),l.Jb(D),l.Jb(b))},t.\u0275cmp=l.Db({type:t,selectors:[["app-profile"]],decls:22,vars:5,consts:[[1,"flex","align-center","space-around"],[3,"photoUrl","enableSend","deletePhoto","updatePhoto"],[1,"update-form","flex","flex-column",3,"formGroup","ngSubmit"],["appearance","standard",1,"mb-16"],["type","text","matInput","","formControlName","firstName"],["type","email","matInput","","formControlName","lastName"],["id","example-radio-group-label"],["aria-labelledby","example-radio-group-label","formControlName","gender",1,"mb-16","flex-column","flex-column"],["value","male",1,"m-8"],["value","female",1,"m-8"],["type","submit","mat-flat-button","","color","primary",3,"disabled"],["type","button","mat-flat-button","","color","danger",1,"logOut-btn",3,"disabled","click"]],template:function(t,e){1&t&&(l.Ob(0,"div",0),l.Ob(1,"app-user-photo",1),l.Vb("deletePhoto",function(){return e.deletePhoto()})("updatePhoto",function(t){return e.updatePhoto(t)}),l.Nb(),l.Ob(2,"form",2),l.Vb("ngSubmit",function(){return e.submitForm()}),l.Ob(3,"mat-form-field",3),l.Ob(4,"mat-label"),l.pc(5,"First name"),l.Nb(),l.Kb(6,"input",4),l.Nb(),l.Ob(7,"mat-form-field",3),l.Ob(8,"mat-label"),l.pc(9,"Last name"),l.Nb(),l.Kb(10,"input",5),l.Nb(),l.Ob(11,"label",6),l.pc(12,"Gender"),l.Nb(),l.Ob(13,"mat-radio-group",7),l.Ob(14,"mat-radio-button",8),l.pc(15,"Male"),l.Nb(),l.Ob(16,"mat-radio-button",9),l.pc(17,"Female"),l.Nb(),l.Nb(),l.Ob(18,"button",10),l.pc(19,"Save"),l.Nb(),l.Nb(),l.Ob(20,"button",11),l.Vb("click",function(){return e.logOut()}),l.pc(21,"Log out "),l.Nb(),l.Nb()),2&t&&(l.zb(1),l.cc("photoUrl",e.userPhoto)("enableSend",!0),l.zb(1),l.cc("formGroup",e.updateForm),l.zb(16),l.cc("disabled",e.updateForm.invalid),l.zb(2),l.cc("disabled",e.updateForm.invalid))},directives:[T,A.l,A.h,A.d,f.c,f.f,v.a,A.a,A.g,A.c,j.b,j.a,y.a],styles:[".update-form[_ngcontent-%COMP%]{max-width:300px;min-width:300px}.logOut-btn[_ngcontent-%COMP%]{position:absolute;right:23px;top:80px}"],changeDetection:0}),t})(),B=(()=>{class t{constructor(t){this.router=t,this.imageFallbackUrl=L}ngOnInit(){}redirect(t){this.router.navigate(["profile",t])}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(i.b))},t.\u0275cmp=l.Db({type:t,selectors:[["app-user-card"]],inputs:{user:"user"},decls:8,vars:4,consts:[[1,"cursor-pointer",3,"click"],["mat-card-avatar","",1,"mb-8"],["alt","",1,"user-image",3,"src"]],template:function(t,e){1&t&&(l.Ob(0,"mat-card",0),l.Vb("click",function(){return e.redirect(e.user.id)}),l.Ob(1,"div",1),l.Kb(2,"img",2),l.Nb(),l.Ob(3,"div"),l.Ob(4,"mat-card-title"),l.pc(5),l.Nb(),l.Ob(6,"mat-card-subtitle"),l.pc(7),l.Nb(),l.Nb(),l.Nb()),2&t&&(l.zb(2),l.cc("src",e.user.image||e.imageFallbackUrl,l.jc),l.zb(3),l.sc("",e.user.firstName," ",e.user.lastName,""),l.zb(2),l.qc(e.user.email))},directives:[E.a,E.b,E.f,E.e],styles:[".user-image[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}"]}),t})();function F(t,e){1&t&&l.Kb(0,"app-user-card",3),2&t&&l.cc("user",e.$implicit)}function V(t,e){if(1&t&&(l.Ob(0,"div",1),l.oc(1,F,1,1,"app-user-card",2),l.Nb()),2&t){const t=e.ngIf;l.zb(1),l.cc("ngForOf",t)}}let H=(()=>{class t{constructor(t){this.users=t,this.usersList$=this.users.userList$}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(b))},t.\u0275cmp=l.Db({type:t,selectors:[["app-list"]],decls:2,vars:3,consts:[["class","grid p-40",4,"ngIf"],[1,"grid","p-40"],[3,"user",4,"ngFor","ngForOf"],[3,"user"]],template:function(t,e){1&t&&(l.oc(0,V,2,1,"div",0),l.Yb(1,"async")),2&t&&l.cc("ngIf",l.Zb(1,1,e.usersList$))},directives:[k.j,k.i,B],pipes:[k.b],styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}"],changeDetection:0}),t})(),R=(()=>{class t{constructor(t,e){this.userService=t,this.userSearchService=e}canActivateChild(t,e){return this.next()}canActivate(t,e){return this.next()}next(){return this.userService.userValue||this.userService.loadUserData(),this.userSearchService.usersValue||this.userSearchService.getAllUsers(),!0}}return t.\u0275fac=function(e){return new(e||t)(l.Sb(U),l.Sb(b))},t.\u0275prov=l.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var G=s("eIep");function J(t,e){if(1&t&&(l.Ob(0,"div",1),l.Kb(1,"app-user-photo",2),l.Ob(2,"div"),l.Ob(3,"h2"),l.pc(4),l.Nb(),l.Ob(5,"h3"),l.pc(6),l.Nb(),l.Nb(),l.Nb()),2&t){const t=e.ngIf;l.zb(1),l.cc("enableSend",!1)("photoUrl",t.image),l.zb(3),l.qc(t.firstName&&t.lastName?t.firstName+" "+t.lastName:t.email),l.zb(2),l.qc(t.city&&t.country?t.city+" "+t.country:"Origin unknown")}}let X=(()=>{class t{constructor(t,e){this.route=t,this.apiService=e,this.user$=this.route.params.pipe(Object(u.a)(t=>t.id),Object(G.a)(t=>this.apiService.getUserById(t)))}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(i.a),l.Jb(m))},t.\u0275cmp=l.Db({type:t,selectors:[["app-user-preview"]],decls:2,vars:3,consts:[["class","flex flex-row space-around",4,"ngIf"],[1,"flex","flex-row","space-around"],[3,"enableSend","photoUrl"]],template:function(t,e){1&t&&(l.oc(0,J,7,4,"div",0),l.Yb(1,"async")),2&t&&l.cc("ngIf",l.Zb(1,1,e.user$))},directives:[k.j,T],pipes:[k.b],styles:[""],changeDetection:0}),t})();class K{constructor(){!function(t,e){for(let s in e.prototype)t.prototype[s]=e.prototype[s]}(K,google.maps.OverlayView)}}function W(t){return Object.keys(t).reduce((e,s)=>(t[s]&&e.push(s+":"+t[s]),e),[]).join(";")}function q(t){return t?t+"px":void 0}class Q extends K{constructor(t,e){super(),this.cluster_=t,this.styles_=e,this.center_=null,this.div_=null,this.sums_=null,this.visible_=!1,this.style=null,this.setMap(t.getMap())}onAdd(){let t,e;const s=this.cluster_.getMarkerClusterer(),[i,r]=google.maps.version.split("."),n=100*parseInt(i,10)+parseInt(r,10);this.div_=document.createElement("div"),this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){e=t}),google.maps.event.addDomListener(this.div_,"mousedown",()=>{t=!0,e=!1}),n>=332&&google.maps.event.addDomListener(this.div_,"touchstart",t=>{t.stopPropagation()}),google.maps.event.addDomListener(this.div_,"click",i=>{if(t=!1,!e){if(google.maps.event.trigger(s,"click",this.cluster_),google.maps.event.trigger(s,"clusterclick",this.cluster_),s.getZoomOnClick()){const t=s.getMaxZoom(),e=this.cluster_.getBounds();s.getMap().fitBounds(e),setTimeout(function(){s.getMap().fitBounds(e),null!==t&&s.getMap().getZoom()>t&&s.getMap().setZoom(t+1)},100)}i.cancelBubble=!0,i.stopPropagation&&i.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",()=>{google.maps.event.trigger(s,"mouseover",this.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",()=>{google.maps.event.trigger(s,"mouseout",this.cluster_)})}onRemove(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)}draw(){if(this.visible_){const t=this.getPosFromLatLng_(this.center_);this.div_.style.top=t.y+"px",this.div_.style.left=t.x+"px"}}hide(){this.div_&&(this.div_.style.display="none"),this.visible_=!1}show(){this.div_&&(this.div_.className=this.className_,this.div_.style.cssText=this.createCss_(this.getPosFromLatLng_(this.center_)),this.div_.innerHTML=(this.style.url?this.getImageElementHtml():"")+this.getLabelDivHtml(),this.div_.title=void 0===this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""),this.visible_=!0}getLabelDivHtml(){return`\n<div aria-label="${this.cluster_.getMarkerClusterer().ariaLabelFn(this.sums_.text)}" style="${W({position:"absolute",top:q(this.anchorText_[0]),left:q(this.anchorText_[1]),color:this.style.textColor,"font-size":q(this.style.textSize),"font-family":this.style.fontFamily,"font-weight":this.style.fontWeight,"font-style":this.style.fontStyle,"text-decoration":this.style.textDecoration,"text-align":"center",width:q(this.style.width),"line-height":q(this.style.textLineHeight)})}" tabindex="0">\n  <span aria-hidden="true">${this.sums_.text}</span>\n</div>\n`}getImageElementHtml(){const t=(this.style.backgroundPosition||"0 0").split(" "),e=parseInt(t[0].replace(/^\s+|\s+$/g,""),10),s=parseInt(t[1].replace(/^\s+|\s+$/g,""),10);let i={};if(this.cluster_.getMarkerClusterer().getEnableRetinaIcons())i={width:q(this.style.width),height:q(this.style.height)};else{const[t,r,n,a]=[-1*s,-1*e+this.style.width,-1*s+this.style.height,-1*e];i={clip:`rect(${t}px, ${r}px, ${n}px, ${a}px)`}}const r=W(Object.assign({position:"absolute",top:q(s),left:q(e)},i));return`<img alt="${this.sums_.text}" aria-hidden="true" src="${this.style.url}" style="${r}"/>`}useStyle(t){this.sums_=t;let e=Math.max(0,t.index-1);e=Math.min(this.styles_.length-1,e),this.style=this.styles_[e],this.anchorText_=this.style.anchorText||[0,0],this.anchorIcon_=this.style.anchorIcon||[Math.floor(this.style.height/2),Math.floor(this.style.width/2)],this.className_=this.cluster_.getMarkerClusterer().getClusterClass()+" "+(this.style.className||"cluster-"+e)}setCenter(t){this.center_=t}createCss_(t){return W({"z-index":""+this.cluster_.getMarkerClusterer().getZIndex(),top:q(t.y),left:q(t.x),width:q(this.style.width),height:q(this.style.height),cursor:"pointer",position:"absolute","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"})}getPosFromLatLng_(t){const e=this.getProjection().fromLatLngToDivPixel(t);return e.x=Math.floor(e.x-this.anchorIcon_[1]),e.y=Math.floor(e.y-this.anchorIcon_[0]),e}}class Y{constructor(t){this.markerClusterer_=t,this.map_=this.markerClusterer_.getMap(),this.minClusterSize_=this.markerClusterer_.getMinimumClusterSize(),this.averageCenter_=this.markerClusterer_.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new Q(this,this.markerClusterer_.getStyles())}getSize(){return this.markers_.length}getMarkers(){return this.markers_}getCenter(){return this.center_}getMap(){return this.map_}getMarkerClusterer(){return this.markerClusterer_}getBounds(){const t=new google.maps.LatLngBounds(this.center_,this.center_),e=this.getMarkers();for(let s=0;s<e.length;s++)t.extend(e[s].getPosition());return t}remove(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_}addMarker(t){if(this.isMarkerAlreadyAdded_(t))return!1;if(this.center_){if(this.averageCenter_){const e=this.markers_.length+1,s=(this.center_.lat()*(e-1)+t.getPosition().lat())/e,i=(this.center_.lng()*(e-1)+t.getPosition().lng())/e;this.center_=new google.maps.LatLng(s,i),this.calculateBounds_()}}else this.center_=t.getPosition(),this.calculateBounds_();t.isAdded=!0,this.markers_.push(t);const e=this.markers_.length,s=this.markerClusterer_.getMaxZoom();if(null!==s&&this.map_.getZoom()>s)t.getMap()!==this.map_&&t.setMap(this.map_);else if(e<this.minClusterSize_)t.getMap()!==this.map_&&t.setMap(this.map_);else if(e===this.minClusterSize_)for(let i=0;i<e;i++)this.markers_[i].setMap(null);else t.setMap(null);return!0}isMarkerInClusterBounds(t){return this.bounds_.contains(t.getPosition())}calculateBounds_(){const t=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(t)}updateIcon(){const t=this.markers_.length,e=this.markerClusterer_.getMaxZoom();if(null!==e&&this.map_.getZoom()>e)return void this.clusterIcon_.hide();if(t<this.minClusterSize_)return void this.clusterIcon_.hide();const s=this.markerClusterer_.getStyles().length,i=this.markerClusterer_.getCalculator()(this.markers_,s);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(i),this.clusterIcon_.show()}isMarkerAlreadyAdded_(t){if(this.markers_.indexOf)return-1!==this.markers_.indexOf(t);for(let e=0;e<this.markers_.length;e++)if(t===this.markers_[e])return!0;return!1}}const tt=(t,e,s)=>void 0!==t[e]?t[e]:s;class et extends K{constructor(t,e=[],s={}){super(),this.options=s,this.markers_=[],this.clusters_=[],this.listeners_=[],this.activeMap_=null,this.ready_=!1,this.ariaLabelFn=this.options.ariaLabelFn||(()=>""),this.zIndex_=this.options.zIndex||google.maps.Marker.MAX_ZINDEX+1,this.gridSize_=this.options.gridSize||60,this.minClusterSize_=this.options.minimumClusterSize||2,this.maxZoom_=this.options.maxZoom||null,this.styles_=this.options.styles||[],this.title_=this.options.title||"",this.zoomOnClick_=tt(this.options,"zoomOnClick",!0),this.averageCenter_=tt(this.options,"averageCenter",!1),this.ignoreHidden_=tt(this.options,"ignoreHidden",!1),this.enableRetinaIcons_=tt(this.options,"enableRetinaIcons",!1),this.imagePath_=this.options.imagePath||et.IMAGE_PATH,this.imageExtension_=this.options.imageExtension||et.IMAGE_EXTENSION,this.imageSizes_=this.options.imageSizes||et.IMAGE_SIZES,this.calculator_=this.options.calculator||et.CALCULATOR,this.batchSize_=this.options.batchSize||et.BATCH_SIZE,this.batchSizeIE_=this.options.batchSizeIE||et.BATCH_SIZE_IE,this.clusterClass_=this.options.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_),this.setupStyles_(),this.addMarkers(e,!0),this.setMap(t)}onAdd(){this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.prevZoom_=this.getMap().getZoom(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",()=>{const t=this.getMap(),e=t.minZoom||0,s=Math.min(t.maxZoom||100,t.mapTypes[t.getMapTypeId()].maxZoom),i=Math.min(Math.max(this.getMap().getZoom(),e),s);this.prevZoom_!=i&&(this.prevZoom_=i,this.resetViewport_(!1))}),google.maps.event.addListener(this.getMap(),"idle",()=>{this.redraw_()})]}onRemove(){for(let t=0;t<this.markers_.length;t++)this.markers_[t].getMap()!==this.activeMap_&&this.markers_[t].setMap(this.activeMap_);for(let t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();this.clusters_=[];for(let t=0;t<this.listeners_.length;t++)google.maps.event.removeListener(this.listeners_[t]);this.listeners_=[],this.activeMap_=null,this.ready_=!1}draw(){}setupStyles_(){if(!(this.styles_.length>0))for(let t=0;t<this.imageSizes_.length;t++){const e=this.imageSizes_[t];this.styles_.push(et.withDefaultStyle({url:this.imagePath_+(t+1)+"."+this.imageExtension_,height:e,width:e}))}}fitMapToMarkers(t){const e=this.getMarkers(),s=new google.maps.LatLngBounds;for(let i=0;i<e.length;i++)!e[i].getVisible()&&this.getIgnoreHidden()||s.extend(e[i].getPosition());this.getMap().fitBounds(s,t)}getGridSize(){return this.gridSize_}setGridSize(t){this.gridSize_=t}getMinimumClusterSize(){return this.minClusterSize_}setMinimumClusterSize(t){this.minClusterSize_=t}getMaxZoom(){return this.maxZoom_}setMaxZoom(t){this.maxZoom_=t}getZIndex(){return this.zIndex_}setZIndex(t){this.zIndex_=t}getStyles(){return this.styles_}setStyles(t){this.styles_=t}getTitle(){return this.title_}setTitle(t){this.title_=t}getZoomOnClick(){return this.zoomOnClick_}setZoomOnClick(t){this.zoomOnClick_=t}getAverageCenter(){return this.averageCenter_}setAverageCenter(t){this.averageCenter_=t}getIgnoreHidden(){return this.ignoreHidden_}setIgnoreHidden(t){this.ignoreHidden_=t}getEnableRetinaIcons(){return this.enableRetinaIcons_}setEnableRetinaIcons(t){this.enableRetinaIcons_=t}getImageExtension(){return this.imageExtension_}setImageExtension(t){this.imageExtension_=t}getImagePath(){return this.imagePath_}setImagePath(t){this.imagePath_=t}getImageSizes(){return this.imageSizes_}setImageSizes(t){this.imageSizes_=t}getCalculator(){return this.calculator_}setCalculator(t){this.calculator_=t}getBatchSizeIE(){return this.batchSizeIE_}setBatchSizeIE(t){this.batchSizeIE_=t}getClusterClass(){return this.clusterClass_}setClusterClass(t){this.clusterClass_=t}getMarkers(){return this.markers_}getTotalMarkers(){return this.markers_.length}getClusters(){return this.clusters_}getTotalClusters(){return this.clusters_.length}addMarker(t,e){this.pushMarkerTo_(t),e||this.redraw_()}addMarkers(t,e){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&this.pushMarkerTo_(t[s]);e||this.redraw_()}pushMarkerTo_(t){t.getDraggable()&&google.maps.event.addListener(t,"dragend",()=>{this.ready_&&(t.isAdded=!1,this.repaint())}),t.isAdded=!1,this.markers_.push(t)}removeMarker(t,e){const s=this.removeMarker_(t);return!e&&s&&this.repaint(),s}removeMarkers(t,e){let s=!1;for(let i=0;i<t.length;i++){const e=this.removeMarker_(t[i]);s=s||e}return!e&&s&&this.repaint(),s}removeMarker_(t){let e=-1;if(this.markers_.indexOf)e=this.markers_.indexOf(t);else for(let s=0;s<this.markers_.length;s++)if(t===this.markers_[s]){e=s;break}return-1!==e&&(t.setMap(null),this.markers_.splice(e,1),!0)}clearMarkers(){this.resetViewport_(!0),this.markers_=[]}repaint(){const t=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){for(let e=0;e<t.length;e++)t[e].remove()},0)}getExtendedBounds(t){const e=this.getProjection(),s=new google.maps.LatLng(t.getNorthEast().lat(),t.getNorthEast().lng()),i=new google.maps.LatLng(t.getSouthWest().lat(),t.getSouthWest().lng()),r=e.fromLatLngToDivPixel(s);r.x+=this.gridSize_,r.y-=this.gridSize_;const n=e.fromLatLngToDivPixel(i);n.x-=this.gridSize_,n.y+=this.gridSize_;const a=e.fromDivPixelToLatLng(r),o=e.fromDivPixelToLatLng(n);return t.extend(a),t.extend(o),t}redraw_(){this.createClusters_(0)}resetViewport_(t){for(let e=0;e<this.clusters_.length;e++)this.clusters_[e].remove();this.clusters_=[];for(let e=0;e<this.markers_.length;e++){const s=this.markers_[e];s.isAdded=!1,t&&s.setMap(null)}}distanceBetweenPoints_(t,e){const s=(e.lat()-t.lat())*Math.PI/180,i=(e.lng()-t.lng())*Math.PI/180,r=Math.sin(s/2)*Math.sin(s/2)+Math.cos(t.lat()*Math.PI/180)*Math.cos(e.lat()*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}isMarkerInBounds_(t,e){return e.contains(t.getPosition())}addToClosestCluster_(t){let e=4e4,s=null;for(let i=0;i<this.clusters_.length;i++){const r=this.clusters_[i],n=r.getCenter();if(n){const i=this.distanceBetweenPoints_(n,t.getPosition());i<e&&(e=i,s=r)}}if(s&&s.isMarkerInClusterBounds(t))s.addMarker(t);else{const e=new Y(this);e.addMarker(t),this.clusters_.push(e)}}createClusters_(t){if(!this.ready_)return;let e;0===t&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),e=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));const s=this.getExtendedBounds(e),i=Math.min(t+this.batchSize_,this.markers_.length);for(let r=t;r<i;r++){const t=this.markers_[r];!t.isAdded&&this.isMarkerInBounds_(t,s)&&(!this.ignoreHidden_||this.ignoreHidden_&&t.getVisible())&&this.addToClosestCluster_(t)}if(i<this.markers_.length)this.timerRefStatic=window.setTimeout(()=>{this.createClusters_(i)},0);else{delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this);for(let t=0;t<this.clusters_.length;t++)this.clusters_[t].updateIcon()}}static CALCULATOR(t,e){let s=0;const i=t.length;let r=i;for(;0!==r;)r=Math.floor(r/10),s++;return s=Math.min(s,e),{text:i.toString(),index:s,title:""}}static withDefaultStyle(t){return Object.assign({textColor:"black",textSize:11,textDecoration:"none",textLineHeight:t.height,fontWeight:"bold",fontStyle:"normal",fontFamily:"Arial,sans-serif",backgroundPosition:"0 0"},t)}}et.BATCH_SIZE=2e3,et.BATCH_SIZE_IE=500,et.IMAGE_PATH="../images/m",et.IMAGE_EXTENSION="png",et.IMAGE_SIZES=[53,56,66,78,90];var st=et;const it=["map"],rt=[{path:"",component:I,canActivateChild:[R],children:[{path:"",redirectTo:"profile",pathMatch:"full"},{path:"profile",component:Z},{path:"profile/:id",component:X},{path:"map",component:(()=>{class t{constructor(t,e,s){this.router=t,this.userDataService=e,this.searchUsersService=s,this.searchUsersAround=new l.n,this.currentUser$=this.userDataService.userData,this.foundUsers$=this.searchUsersService.userList$,this.destroyer$=new r.a}ngAfterViewInit(){this.currentUser$.pipe(Object(w.a)(this.destroyer$)).subscribe(t=>{t&&this.initMap(t.lat,t.lon)}),this.foundUsers$.subscribe(t=>{this.map&&this.updateMarkers(t)})}initMap(t,e){const s={center:new google.maps.LatLng(t,e),zoom:11,mapTypeId:google.maps.MapTypeId.TERRAIN};this.map=new google.maps.Map(this.mapElement.nativeElement,s),this.initClusterer()}updateMarkers(t){this.cleanMarkers(),this.markers=[...t.map(t=>{const e=(t=>{const e={url:t.image||L,size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,32),scaledSize:new google.maps.Size(32,32)},s={text:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.email.split("@")[0],color:"#fafafa",className:"label"};return new google.maps.Marker({position:t.lat&&t.lon?{lat:+t.lat,lng:+t.lon}:{lat:50.45466,lng:30.5238},icon:e,shape:{type:"rect"},label:s})})(t);return e.addListener("click",()=>this.router.navigate(["profile",t.id])),e})],this.markersClusterer.addMarkers(this.markers)}initClusterer(){this.markersClusterer=new st(this.map,[],{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})}cleanMarkers(){this.markersClusterer.clearMarkers()}ngOnDestroy(){this.destroyer$.next()}}return t.\u0275fac=function(e){return new(e||t)(l.Jb(i.b),l.Jb(U),l.Jb(b))},t.\u0275cmp=l.Db({type:t,selectors:[["app-map"]],viewQuery:function(t,e){if(1&t&&l.tc(it,!0),2&t){let t;l.gc(t=l.Wb())&&(e.mapElement=t.first)}},outputs:{searchUsersAround:"searchUsersAround"},decls:2,vars:0,consts:[[1,"map"],["map",""]],template:function(t,e){1&t&&l.Kb(0,"div",0,1)},styles:[".map[_ngcontent-%COMP%]{width:80%;height:500px;margin:auto}"],changeDetection:0}),t})()},{path:"list",component:H}]}];let nt=(()=>{class t{}return t.\u0275mod=l.Hb({type:t}),t.\u0275inj=l.Gb({factory:function(e){return new(e||t)},imports:[[i.f.forChild(rt)],i.f]}),t})();var at=s("PCNd");let ot=(()=>{class t{}return t.\u0275mod=l.Hb({type:t}),t.\u0275inj=l.Gb({factory:function(e){return new(e||t)},providers:[D],imports:[[at.a,nt]]}),t})()}}]);