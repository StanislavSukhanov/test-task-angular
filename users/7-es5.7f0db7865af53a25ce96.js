!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var i=[],n=!0,r=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done)&&(i.push(a.value),!t||i.length!==t);n=!0);}catch(u){r=!0,s=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw s}}return i}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){if(e){if("string"==typeof e)return n(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var i,n=u(e);if(t){var r=u(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return o(this,i)}}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{RsyV:function(i,n,s){"use strict";s.r(n),s.d(n,"MainModule",function(){return we});var o,u,l=s("tyNb"),p=s("XNiG"),f=s("Kj3r"),g=s("/uUt"),d=s("vkgz"),m=s("fXoL"),v=s("2Vo4"),b=s("AytR"),y=s("lJxs"),_=s("tk/3"),k=b.a.baseUrl,S=function(e){return e.pipe(Object(y.a)(function(e){return e.result}))},M=((u=function(){function e(t){c(this,e),this.http=t}return h(e,[{key:"getUserDetails",value:function(){return this.http.get(k+"/v1/user/current").pipe(S)}},{key:"updateUserDetails",value:function(e){return this.http.put(k+"/v1/user/profile",e).pipe(S)}},{key:"updateUserPhoto",value:function(e){return this.http.post(k+"/v1/user/profile/image",e).pipe(S)}},{key:"deleteUserPhoto",value:function(){return this.http.delete(k+"/v1/user/profile/image")}},{key:"setUserLocation",value:function(e){return this.http.put(k+"/v1/user/location",e).pipe(S)}},{key:"searchUsers",value:function(e){return this.http.get("".concat(k,"/v1/user/search").concat(e)).pipe(Object(y.a)(function(e){return e.result}))}},{key:"getAllUsers",value:function(){return this.http.get(k+"/v1/user").pipe(Object(y.a)(function(e){return e.result}))}},{key:"getUserById",value:function(e){return this.http.get("".concat(k,"/v1/user/").concat(e)).pipe(Object(y.a)(function(e){return e.result}))}},{key:"logOut",value:function(){return this.http.post(k+"/v1/user/logout",{})}}]),e}()).\u0275fac=function(e){return new(e||u)(m.Sb(_.b))},u.\u0275prov=m.Fb({token:u,factory:u.\u0275fac,providedIn:"root"}),u),x=((o=function(){function e(t){c(this,e),this.apiService=t,this.usersList=new v.a(null),this.userList$=this.usersList.asObservable()}return h(e,[{key:"getUsers",value:function(e){var t=this;this.apiService.searchUsers(e).pipe(Object(d.a)(function(e){t.usersList.next(e)})).subscribe()}},{key:"getAllUsers",value:function(){var e=this;this.apiService.getAllUsers().pipe(Object(d.a)(function(t){e.usersList.next(t)})).subscribe()}},{key:"usersValue",get:function(){return this.usersList.value}}]),e}()).\u0275fac=function(e){return new(e||o)(m.Sb(M))},o.\u0275prov=m.Fb({token:o,factory:o.\u0275fac,providedIn:"root"}),o),O=s("wZkO"),C=s("kmnG"),w=s("qFsG"),I=s("ofXK"),P=s("bTqV"),L=s("NFeN");function z(e,t){if(1&e){var i=m.Pb();m.Ob(0,"button",12),m.Vb("click",function(){m.ic(i);var e=m.Xb();return m.hc(13).value="",e.searchUsers("")}),m.Ob(1,"mat-icon"),m.pc(2,"close"),m.Nb(),m.Nb()}}var N,U,A,D=function(){return["/map"]},j=function(){return["/list"]},E=function(){return["/profile"]},T=((N=function(){function e(t){c(this,e),this.searchUsersService=t,this.searchSubject$=new p.a,this.destroy$=new p.a}return h(e,[{key:"ngOnInit",value:function(){var e=this;this.searchSubject$.pipe(Object(f.a)(300),Object(g.a)(),Object(d.a)(function(t){e.searchUsersService.getUsers("?searchString="+t)})).subscribe()}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"searchUsers",value:function(e){this.searchSubject$.next(e)}}]),e}()).\u0275fac=function(e){return new(e||N)(m.Jb(x))},N.\u0275cmp=m.Db({type:N,selectors:[["app-main-layout"]],decls:19,vars:11,consts:[[1,"pt-16","mb-100"],["mat-tab-nav-bar","",3,"backgroundColor"],["mat-tab-link","","routerLinkActive","",3,"active","routerLink"],["rla","routerLinkActive"],["rla2","routerLinkActive"],[1,"header-right","pr-24"],[1,"search","mr-40"],["matInput","","type","text",3,"input"],["searchInput",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["mat-flat-button","","routerLinkActive","","role","link",3,"routerLink","color"],["rlaButton","routerLinkActive"],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"]],template:function(e,t){if(1&e){var i=m.Pb();m.Ob(0,"header",0),m.Ob(1,"nav",1),m.Ob(2,"a",2,3),m.pc(4,"Map"),m.Nb(),m.Ob(5,"a",2,4),m.pc(7,"List"),m.Nb(),m.Nb(),m.Ob(8,"div",5),m.Ob(9,"mat-form-field",6),m.Ob(10,"mat-label"),m.pc(11,"Search"),m.Nb(),m.Ob(12,"input",7,8),m.Vb("input",function(){m.ic(i);var e=m.hc(13);return t.searchUsers(e.value)}),m.Nb(),m.oc(14,z,3,0,"button",9),m.Nb(),m.Ob(15,"button",10,11),m.pc(17,"Profile "),m.Nb(),m.Nb(),m.Nb(),m.Kb(18,"router-outlet")}if(2&e){var n=m.hc(3),r=m.hc(6),s=m.hc(13),a=m.hc(16);m.zb(1),m.cc("backgroundColor","blue"),m.zb(1),m.cc("active",n.isActive)("routerLink",m.dc(8,D)),m.zb(3),m.cc("active",r.isActive)("routerLink",m.dc(9,j)),m.zb(9),m.cc("ngIf",s.value),m.zb(1),m.cc("routerLink",m.dc(10,E))("color",a.isActive?"primary":"basic")}},directives:[O.b,l.e,O.a,l.d,C.c,C.f,w.a,I.j,P.a,l.c,l.g,C.g,L.a],styles:["header[_ngcontent-%COMP%]{position:relative}.header-right[_ngcontent-%COMP%]{position:absolute;right:0;top:16px;z-index:5}.header-right[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:200px}"],changeDetection:0}),N),Z=s("1G5W"),B="https://hajiri.co/uploads/no_image.jpg",F=[{lat:50.431773,lon:30.424636},{lat:50.431773,lon:30.424636},{lat:50.459637,lon:30.428946},{lat:50.463541,lon:30.454595},{lat:50.477655,lon:30.534808},{lat:50.464036,lon:30.553635},{lat:50.461687,lon:30.570799},{lat:50.456198,lon:30.621799},{lat:50.38017,lon:30.568871},{lat:50.37816,lon:30.603209}],$=function(e){var t=parseInt(e.toString(),16);return F[t%10]},R=s("1/+G"),V=((U=function(){function e(t,i,n){c(this,e),this.apiService=t,this.storageService=i,this.router=n,this.currentUser$=new v.a(null)}return h(e,[{key:"setUser",value:function(e){this.currentUser$.next(e)}},{key:"loadUserData",value:function(){var e=this;this.apiService.getUserDetails().pipe(Object(d.a)(function(t){return e.setUser(t)})).subscribe(function(t){t.lon&&t.lat||e.setLocation(t.id)})}},{key:"updateUserData",value:function(e){var t=this;this.apiService.updateUserDetails(e).pipe(Object(d.a)(function(e){return t.setUser(e)})).subscribe()}},{key:"updateUserPhoto",value:function(e){var t=this;this.apiService.updateUserPhoto(e).pipe(Object(d.a)(function(e){return t.setUser(e)})).subscribe()}},{key:"deletePhoto",value:function(){var e=this;this.apiService.deleteUserPhoto().pipe(Object(d.a)(function(){var t=e.userValue;delete t.image,e.setUser(t)})).subscribe()}},{key:"setLocation",value:function(e){var t=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.apiService.setUserLocation({lat:e.coords.latitude,lon:e.coords.longitude}).pipe(Object(d.a)(function(e){return t.setUser(e)})).subscribe()},function(){t.apiService.setUserLocation($(e)).pipe(Object(d.a)(function(e){return t.setUser(e)})).subscribe()},{maximumAge:6e4,timeout:5e3,enableHighAccuracy:!0}):this.apiService.setUserLocation($(e)).pipe(Object(d.a)(function(e){return t.setUser(e)})).subscribe()}},{key:"logOut",value:function(){var e=this;return this.apiService.logOut().subscribe(function(t){e.storageService.remove("token"),e.setUser(null),e.router.navigate(["auth"])})}},{key:"userData",get:function(){return this.currentUser$.asObservable()}},{key:"userValue",get:function(){return this.currentUser$.value}}]),e}()).\u0275fac=function(e){return new(e||U)(m.Sb(M),m.Sb(R.a),m.Sb(l.b))},U.\u0275prov=m.Fb({token:U,factory:U.\u0275fac,providedIn:"root"}),U),H=s("3Pt+"),G=((A=function(){function e(t){c(this,e),this.fb=t}return h(e,[{key:"getProfileForm",value:function(){return this.fb.group({firstName:[null],lastName:[null],gender:[null],email:[null,[H.k.required]]})}}]),e}()).\u0275fac=function(e){return new(e||A)(m.Sb(H.b))},A.\u0275prov=m.Fb({token:A,factory:A.\u0275fac,providedIn:"root"}),A),J=s("Wp6s");function X(e,t){if(1&e){var i=m.Pb();m.Ob(0,"div",4),m.Ob(1,"input",5,6),m.Vb("change",function(e){return m.ic(i),m.Xb().handleUpload(e.target.files)}),m.Nb(),m.Ob(3,"button",7),m.Vb("click",function(){m.ic(i);var e=m.hc(2);return m.Xb().focus(e)}),m.pc(4,"Upload photo"),m.Nb(),m.Ob(5,"button",8),m.Vb("click",function(){return m.ic(i),m.Xb().delete()}),m.pc(6,"Delete photo"),m.Nb(),m.Nb()}}var K,W,q,Q=((K=function(){function e(){c(this,e),this.updatePhoto=new m.n,this.deletePhoto=new m.n,this.fallbackPhotoUrl=B}return h(e,[{key:"update",value:function(){this.updatePhoto.emit()}},{key:"delete",value:function(){this.deletePhoto.emit()}},{key:"focus",value:function(e){e.click()}},{key:"handleUpload",value:function(e){if(e&&e.length>0){var t=new FormData;t.append("image",e[0]),this.updatePhoto.emit(t)}}}]),e}()).\u0275fac=function(e){return new(e||K)},K.\u0275cmp=m.Db({type:K,selectors:[["app-user-photo"]],inputs:{photoUrl:"photoUrl",enableSend:"enableSend"},outputs:{updatePhoto:"updatePhoto",deletePhoto:"deletePhoto"},decls:4,vars:2,consts:[[1,"flex","flex-column","align-center"],[1,"image-container","mb-32"],["mat-card-image","","alt","user photo",3,"src"],["class","flex flex-row space-between",4,"ngIf"],[1,"flex","flex-row","space-between"],["id","fileInput","type","file",2,"display","none",3,"change"],["ref",""],["mat-flat-button","","color","primary",2,"margin-right","8px",3,"click"],["mat-flat-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(m.Ob(0,"div",0),m.Ob(1,"mat-card",1),m.Kb(2,"img",2),m.Nb(),m.oc(3,X,7,0,"div",3),m.Nb()),2&e&&(m.zb(2),m.cc("src",t.photoUrl||t.fallbackPhotoUrl,m.jc),m.zb(1),m.cc("ngIf",t.enableSend))},directives:[J.a,J.c,I.j,P.a],styles:[".image-container[_ngcontent-%COMP%]{max-width:250px;max-height:250px}"],changeDetection:0}),K),Y=s("QibW"),ee=((q=function(){function e(t,i,n){c(this,e),this.userDataService=t,this.formService=i,this.users=n,this.user$=this.userDataService.userData,this.destroy$=new p.a,this.updateForm=this.formService.getProfileForm()}return h(e,[{key:"ngOnInit",value:function(){var e=this;this.user$.pipe(Object(Z.a)(this.destroy$)).subscribe(function(t){t&&(e.updateForm.patchValue(t),e.userPhoto=t.image||"")})}},{key:"ngOnDestroy",value:function(){this.destroy$.next()}},{key:"submitForm",value:function(){this.userDataService.updateUserData(this.updateForm.value)}},{key:"deletePhoto",value:function(){this.userDataService.deletePhoto()}},{key:"updatePhoto",value:function(e){this.userDataService.updateUserPhoto(e),this.users.getAllUsers()}},{key:"logOut",value:function(){this.userDataService.logOut()}}]),e}()).\u0275fac=function(e){return new(e||q)(m.Jb(V),m.Jb(G),m.Jb(x))},q.\u0275cmp=m.Db({type:q,selectors:[["app-profile"]],decls:22,vars:5,consts:[[1,"flex","align-center","space-around"],[3,"photoUrl","enableSend","deletePhoto","updatePhoto"],[1,"update-form","flex","flex-column",3,"formGroup","ngSubmit"],["appearance","standard",1,"mb-16"],["type","text","matInput","","formControlName","firstName"],["type","email","matInput","","formControlName","lastName"],["id","example-radio-group-label"],["aria-labelledby","example-radio-group-label","formControlName","gender",1,"mb-16","flex-column","flex-column"],["value","male",1,"m-8"],["value","female",1,"m-8"],["type","submit","mat-flat-button","","color","primary",3,"disabled"],["type","button","mat-flat-button","","color","danger",1,"logOut-btn",3,"disabled","click"]],template:function(e,t){1&e&&(m.Ob(0,"div",0),m.Ob(1,"app-user-photo",1),m.Vb("deletePhoto",function(){return t.deletePhoto()})("updatePhoto",function(e){return t.updatePhoto(e)}),m.Nb(),m.Ob(2,"form",2),m.Vb("ngSubmit",function(){return t.submitForm()}),m.Ob(3,"mat-form-field",3),m.Ob(4,"mat-label"),m.pc(5,"First name"),m.Nb(),m.Kb(6,"input",4),m.Nb(),m.Ob(7,"mat-form-field",3),m.Ob(8,"mat-label"),m.pc(9,"Last name"),m.Nb(),m.Kb(10,"input",5),m.Nb(),m.Ob(11,"label",6),m.pc(12,"Gender"),m.Nb(),m.Ob(13,"mat-radio-group",7),m.Ob(14,"mat-radio-button",8),m.pc(15,"Male"),m.Nb(),m.Ob(16,"mat-radio-button",9),m.pc(17,"Female"),m.Nb(),m.Nb(),m.Ob(18,"button",10),m.pc(19,"Save"),m.Nb(),m.Nb(),m.Ob(20,"button",11),m.Vb("click",function(){return t.logOut()}),m.pc(21,"Log out "),m.Nb(),m.Nb()),2&e&&(m.zb(1),m.cc("photoUrl",t.userPhoto)("enableSend",!0),m.zb(1),m.cc("formGroup",t.updateForm),m.zb(16),m.cc("disabled",t.updateForm.invalid),m.zb(2),m.cc("disabled",t.updateForm.invalid))},directives:[Q,H.l,H.h,H.d,C.c,C.f,w.a,H.a,H.g,H.c,Y.b,Y.a,P.a],styles:[".update-form[_ngcontent-%COMP%]{max-width:300px;min-width:300px}.logOut-btn[_ngcontent-%COMP%]{position:absolute;right:23px;top:80px}"],changeDetection:0}),q),te=((W=function(){function e(t){c(this,e),this.router=t,this.imageFallbackUrl=B}return h(e,[{key:"ngOnInit",value:function(){}},{key:"redirect",value:function(e){this.router.navigate(["profile",e])}}]),e}()).\u0275fac=function(e){return new(e||W)(m.Jb(l.b))},W.\u0275cmp=m.Db({type:W,selectors:[["app-user-card"]],inputs:{user:"user"},decls:8,vars:4,consts:[[1,"cursor-pointer",3,"click"],["mat-card-avatar","",1,"mb-8"],["alt","",1,"user-image",3,"src"]],template:function(e,t){1&e&&(m.Ob(0,"mat-card",0),m.Vb("click",function(){return t.redirect(t.user.id)}),m.Ob(1,"div",1),m.Kb(2,"img",2),m.Nb(),m.Ob(3,"div"),m.Ob(4,"mat-card-title"),m.pc(5),m.Nb(),m.Ob(6,"mat-card-subtitle"),m.pc(7),m.Nb(),m.Nb(),m.Nb()),2&e&&(m.zb(2),m.cc("src",t.user.image||t.imageFallbackUrl,m.jc),m.zb(3),m.sc("",t.user.firstName," ",t.user.lastName,""),m.zb(2),m.qc(t.user.email))},directives:[J.a,J.b,J.f,J.e],styles:[".user-image[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:50%}"]}),W);function ie(e,t){1&e&&m.Kb(0,"app-user-card",3),2&e&&m.cc("user",t.$implicit)}function ne(e,t){if(1&e&&(m.Ob(0,"div",1),m.oc(1,ie,1,1,"app-user-card",2),m.Nb()),2&e){var i=t.ngIf;m.zb(1),m.cc("ngForOf",i)}}var re,se,ae=((se=function(){function e(t){c(this,e),this.users=t,this.usersList$=this.users.userList$}return h(e,[{key:"ngOnInit",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||se)(m.Jb(x))},se.\u0275cmp=m.Db({type:se,selectors:[["app-list"]],decls:2,vars:3,consts:[["class","grid p-40",4,"ngIf"],[1,"grid","p-40"],[3,"user",4,"ngFor","ngForOf"],[3,"user"]],template:function(e,t){1&e&&(m.oc(0,ne,2,1,"div",0),m.Yb(1,"async")),2&e&&m.cc("ngIf",m.Zb(1,1,t.usersList$))},directives:[I.j,I.i,te],pipes:[I.b],styles:[".grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-gap:16px}"],changeDetection:0}),se),oe=((re=function(){function e(t,i){c(this,e),this.userService=t,this.userSearchService=i}return h(e,[{key:"canActivateChild",value:function(e,t){return this.next()}},{key:"canActivate",value:function(e,t){return this.next()}},{key:"next",value:function(){return this.userService.userValue||this.userService.loadUserData(),this.userSearchService.usersValue||this.userSearchService.getAllUsers(),!0}}]),e}()).\u0275fac=function(e){return new(e||re)(m.Sb(V),m.Sb(x))},re.\u0275prov=m.Fb({token:re,factory:re.\u0275fac,providedIn:"root"}),re),ue=s("eIep");function ce(e,t){if(1&e&&(m.Ob(0,"div",1),m.Kb(1,"app-user-photo",2),m.Ob(2,"div"),m.Ob(3,"h2"),m.pc(4),m.Nb(),m.Ob(5,"h3"),m.pc(6),m.Nb(),m.Nb(),m.Nb()),2&e){var i=t.ngIf;m.zb(1),m.cc("enableSend",!1)("photoUrl",i.image),m.zb(3),m.qc(i.firstName&&i.lastName?i.firstName+" "+i.lastName:i.email),m.zb(2),m.qc(i.city&&i.country?i.city+" "+i.country:"Origin unknown")}}var le,he=((le=function e(t,i){var n=this;c(this,e),this.route=t,this.apiService=i,this.user$=this.route.params.pipe(Object(y.a)(function(e){return e.id}),Object(ue.a)(function(e){return n.apiService.getUserById(e)}))}).\u0275fac=function(e){return new(e||le)(m.Jb(l.a),m.Jb(M))},le.\u0275cmp=m.Db({type:le,selectors:[["app-user-preview"]],decls:2,vars:3,consts:[["class","flex flex-row space-around",4,"ngIf"],[1,"flex","flex-row","space-around"],[3,"enableSend","photoUrl"]],template:function(e,t){1&e&&(m.oc(0,ce,7,4,"div",0),m.Yb(1,"async")),2&e&&m.cc("ngIf",m.Zb(1,1,t.user$))},directives:[I.j,Q],pipes:[I.b],styles:[""],changeDetection:0}),le),pe=function e(){c(this,e),function(e,t){for(var i in t.prototype)e.prototype[i]=t.prototype[i]}(e,google.maps.OverlayView)};function fe(e){return Object.keys(e).reduce(function(t,i){return e[i]&&t.push(i+":"+e[i]),t},[]).join(";")}function ge(e){return e?e+"px":void 0}var de=function(e){r(n,e);var i=a(n);function n(e,t){var r;return c(this,n),(r=i.call(this)).cluster_=e,r.styles_=t,r.center_=null,r.div_=null,r.sums_=null,r.visible_=!1,r.style=null,r.setMap(e.getMap()),r}return h(n,[{key:"onAdd",value:function(){var e,i,n=this,r=this.cluster_.getMarkerClusterer(),s=t(google.maps.version.split("."),2),a=s[0],o=s[1],u=100*parseInt(a,10)+parseInt(o,10);this.div_=document.createElement("div"),this.visible_&&this.show(),this.getPanes().overlayMouseTarget.appendChild(this.div_),this.boundsChangedListener_=google.maps.event.addListener(this.getMap(),"bounds_changed",function(){i=e}),google.maps.event.addDomListener(this.div_,"mousedown",function(){e=!0,i=!1}),u>=332&&google.maps.event.addDomListener(this.div_,"touchstart",function(e){e.stopPropagation()}),google.maps.event.addDomListener(this.div_,"click",function(t){if(e=!1,!i){if(google.maps.event.trigger(r,"click",n.cluster_),google.maps.event.trigger(r,"clusterclick",n.cluster_),r.getZoomOnClick()){var s=r.getMaxZoom(),a=n.cluster_.getBounds();r.getMap().fitBounds(a),setTimeout(function(){r.getMap().fitBounds(a),null!==s&&r.getMap().getZoom()>s&&r.getMap().setZoom(s+1)},100)}t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}}),google.maps.event.addDomListener(this.div_,"mouseover",function(){google.maps.event.trigger(r,"mouseover",n.cluster_)}),google.maps.event.addDomListener(this.div_,"mouseout",function(){google.maps.event.trigger(r,"mouseout",n.cluster_)})}},{key:"onRemove",value:function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.removeListener(this.boundsChangedListener_),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)}},{key:"draw",value:function(){if(this.visible_){var e=this.getPosFromLatLng_(this.center_);this.div_.style.top=e.y+"px",this.div_.style.left=e.x+"px"}}},{key:"hide",value:function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1}},{key:"show",value:function(){this.div_&&(this.div_.className=this.className_,this.div_.style.cssText=this.createCss_(this.getPosFromLatLng_(this.center_)),this.div_.innerHTML=(this.style.url?this.getImageElementHtml():"")+this.getLabelDivHtml(),this.div_.title=void 0===this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title,this.div_.style.display=""),this.visible_=!0}},{key:"getLabelDivHtml",value:function(){return'\n<div aria-label="'.concat(this.cluster_.getMarkerClusterer().ariaLabelFn(this.sums_.text),'" style="').concat(fe({position:"absolute",top:ge(this.anchorText_[0]),left:ge(this.anchorText_[1]),color:this.style.textColor,"font-size":ge(this.style.textSize),"font-family":this.style.fontFamily,"font-weight":this.style.fontWeight,"font-style":this.style.fontStyle,"text-decoration":this.style.textDecoration,"text-align":"center",width:ge(this.style.width),"line-height":ge(this.style.textLineHeight)}),'" tabindex="0">\n  <span aria-hidden="true">').concat(this.sums_.text,"</span>\n</div>\n")}},{key:"getImageElementHtml",value:function(){var e=(this.style.backgroundPosition||"0 0").split(" "),t=parseInt(e[0].replace(/^\s+|\s+$/g,""),10),i=parseInt(e[1].replace(/^\s+|\s+$/g,""),10),n={};if(this.cluster_.getMarkerClusterer().getEnableRetinaIcons())n={width:ge(this.style.width),height:ge(this.style.height)};else{var r=-1*i,s=-1*t+this.style.width,a=-1*i+this.style.height,o=-1*t;n={clip:"rect(".concat(r,"px, ").concat(s,"px, ").concat(a,"px, ").concat(o,"px)")}}var u=fe(Object.assign({position:"absolute",top:ge(i),left:ge(t)},n));return'<img alt="'.concat(this.sums_.text,'" aria-hidden="true" src="').concat(this.style.url,'" style="').concat(u,'"/>')}},{key:"useStyle",value:function(e){this.sums_=e;var t=Math.max(0,e.index-1);t=Math.min(this.styles_.length-1,t),this.style=this.styles_[t],this.anchorText_=this.style.anchorText||[0,0],this.anchorIcon_=this.style.anchorIcon||[Math.floor(this.style.height/2),Math.floor(this.style.width/2)],this.className_=this.cluster_.getMarkerClusterer().getClusterClass()+" "+(this.style.className||"cluster-"+t)}},{key:"setCenter",value:function(e){this.center_=e}},{key:"createCss_",value:function(e){return fe({"z-index":""+this.cluster_.getMarkerClusterer().getZIndex(),top:ge(e.y),left:ge(e.x),width:ge(this.style.width),height:ge(this.style.height),cursor:"pointer",position:"absolute","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"})}},{key:"getPosFromLatLng_",value:function(e){var t=this.getProjection().fromLatLngToDivPixel(e);return t.x=Math.floor(t.x-this.anchorIcon_[1]),t.y=Math.floor(t.y-this.anchorIcon_[0]),t}}]),n}(pe),me=function(){function e(t){c(this,e),this.markerClusterer_=t,this.map_=this.markerClusterer_.getMap(),this.minClusterSize_=this.markerClusterer_.getMinimumClusterSize(),this.averageCenter_=this.markerClusterer_.getAverageCenter(),this.markers_=[],this.center_=null,this.bounds_=null,this.clusterIcon_=new de(this,this.markerClusterer_.getStyles())}return h(e,[{key:"getSize",value:function(){return this.markers_.length}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getCenter",value:function(){return this.center_}},{key:"getMap",value:function(){return this.map_}},{key:"getMarkerClusterer",value:function(){return this.markerClusterer_}},{key:"getBounds",value:function(){for(var e=new google.maps.LatLngBounds(this.center_,this.center_),t=this.getMarkers(),i=0;i<t.length;i++)e.extend(t[i].getPosition());return e}},{key:"remove",value:function(){this.clusterIcon_.setMap(null),this.markers_=[],delete this.markers_}},{key:"addMarker",value:function(e){if(this.isMarkerAlreadyAdded_(e))return!1;if(this.center_){if(this.averageCenter_){var t=this.markers_.length+1,i=(this.center_.lat()*(t-1)+e.getPosition().lat())/t,n=(this.center_.lng()*(t-1)+e.getPosition().lng())/t;this.center_=new google.maps.LatLng(i,n),this.calculateBounds_()}}else this.center_=e.getPosition(),this.calculateBounds_();e.isAdded=!0,this.markers_.push(e);var r=this.markers_.length,s=this.markerClusterer_.getMaxZoom();if(null!==s&&this.map_.getZoom()>s)e.getMap()!==this.map_&&e.setMap(this.map_);else if(r<this.minClusterSize_)e.getMap()!==this.map_&&e.setMap(this.map_);else if(r===this.minClusterSize_)for(var a=0;a<r;a++)this.markers_[a].setMap(null);else e.setMap(null);return!0}},{key:"isMarkerInClusterBounds",value:function(e){return this.bounds_.contains(e.getPosition())}},{key:"calculateBounds_",value:function(){var e=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(e)}},{key:"updateIcon",value:function(){var e=this.markers_.length,t=this.markerClusterer_.getMaxZoom();if(null!==t&&this.map_.getZoom()>t)this.clusterIcon_.hide();else if(e<this.minClusterSize_)this.clusterIcon_.hide();else{var i=this.markerClusterer_.getStyles().length,n=this.markerClusterer_.getCalculator()(this.markers_,i);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(n),this.clusterIcon_.show()}}},{key:"isMarkerAlreadyAdded_",value:function(e){if(this.markers_.indexOf)return-1!==this.markers_.indexOf(e);for(var t=0;t<this.markers_.length;t++)if(e===this.markers_[t])return!0;return!1}}]),e}(),ve=function(e,t,i){return void 0!==e[t]?e[t]:i},be=function(e){r(i,e);var t=a(i);function i(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return c(this,i),(n=t.call(this)).options=s,n.markers_=[],n.clusters_=[],n.listeners_=[],n.activeMap_=null,n.ready_=!1,n.ariaLabelFn=n.options.ariaLabelFn||function(){return""},n.zIndex_=n.options.zIndex||google.maps.Marker.MAX_ZINDEX+1,n.gridSize_=n.options.gridSize||60,n.minClusterSize_=n.options.minimumClusterSize||2,n.maxZoom_=n.options.maxZoom||null,n.styles_=n.options.styles||[],n.title_=n.options.title||"",n.zoomOnClick_=ve(n.options,"zoomOnClick",!0),n.averageCenter_=ve(n.options,"averageCenter",!1),n.ignoreHidden_=ve(n.options,"ignoreHidden",!1),n.enableRetinaIcons_=ve(n.options,"enableRetinaIcons",!1),n.imagePath_=n.options.imagePath||i.IMAGE_PATH,n.imageExtension_=n.options.imageExtension||i.IMAGE_EXTENSION,n.imageSizes_=n.options.imageSizes||i.IMAGE_SIZES,n.calculator_=n.options.calculator||i.CALCULATOR,n.batchSize_=n.options.batchSize||i.BATCH_SIZE,n.batchSizeIE_=n.options.batchSizeIE||i.BATCH_SIZE_IE,n.clusterClass_=n.options.clusterClass||"cluster",-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(n.batchSize_=n.batchSizeIE_),n.setupStyles_(),n.addMarkers(r,!0),n.setMap(e),n}return h(i,[{key:"onAdd",value:function(){var e=this;this.activeMap_=this.getMap(),this.ready_=!0,this.repaint(),this.prevZoom_=this.getMap().getZoom(),this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){var t=e.getMap(),i=t.minZoom||0,n=Math.min(t.maxZoom||100,t.mapTypes[t.getMapTypeId()].maxZoom),r=Math.min(Math.max(e.getMap().getZoom(),i),n);e.prevZoom_!=r&&(e.prevZoom_=r,e.resetViewport_(!1))}),google.maps.event.addListener(this.getMap(),"idle",function(){e.redraw_()})]}},{key:"onRemove",value:function(){for(var e=0;e<this.markers_.length;e++)this.markers_[e].getMap()!==this.activeMap_&&this.markers_[e].setMap(this.activeMap_);for(var t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();this.clusters_=[];for(var i=0;i<this.listeners_.length;i++)google.maps.event.removeListener(this.listeners_[i]);this.listeners_=[],this.activeMap_=null,this.ready_=!1}},{key:"draw",value:function(){}},{key:"setupStyles_",value:function(){if(!(this.styles_.length>0))for(var e=0;e<this.imageSizes_.length;e++){var t=this.imageSizes_[e];this.styles_.push(i.withDefaultStyle({url:this.imagePath_+(e+1)+"."+this.imageExtension_,height:t,width:t}))}}},{key:"fitMapToMarkers",value:function(e){for(var t=this.getMarkers(),i=new google.maps.LatLngBounds,n=0;n<t.length;n++)!t[n].getVisible()&&this.getIgnoreHidden()||i.extend(t[n].getPosition());this.getMap().fitBounds(i,e)}},{key:"getGridSize",value:function(){return this.gridSize_}},{key:"setGridSize",value:function(e){this.gridSize_=e}},{key:"getMinimumClusterSize",value:function(){return this.minClusterSize_}},{key:"setMinimumClusterSize",value:function(e){this.minClusterSize_=e}},{key:"getMaxZoom",value:function(){return this.maxZoom_}},{key:"setMaxZoom",value:function(e){this.maxZoom_=e}},{key:"getZIndex",value:function(){return this.zIndex_}},{key:"setZIndex",value:function(e){this.zIndex_=e}},{key:"getStyles",value:function(){return this.styles_}},{key:"setStyles",value:function(e){this.styles_=e}},{key:"getTitle",value:function(){return this.title_}},{key:"setTitle",value:function(e){this.title_=e}},{key:"getZoomOnClick",value:function(){return this.zoomOnClick_}},{key:"setZoomOnClick",value:function(e){this.zoomOnClick_=e}},{key:"getAverageCenter",value:function(){return this.averageCenter_}},{key:"setAverageCenter",value:function(e){this.averageCenter_=e}},{key:"getIgnoreHidden",value:function(){return this.ignoreHidden_}},{key:"setIgnoreHidden",value:function(e){this.ignoreHidden_=e}},{key:"getEnableRetinaIcons",value:function(){return this.enableRetinaIcons_}},{key:"setEnableRetinaIcons",value:function(e){this.enableRetinaIcons_=e}},{key:"getImageExtension",value:function(){return this.imageExtension_}},{key:"setImageExtension",value:function(e){this.imageExtension_=e}},{key:"getImagePath",value:function(){return this.imagePath_}},{key:"setImagePath",value:function(e){this.imagePath_=e}},{key:"getImageSizes",value:function(){return this.imageSizes_}},{key:"setImageSizes",value:function(e){this.imageSizes_=e}},{key:"getCalculator",value:function(){return this.calculator_}},{key:"setCalculator",value:function(e){this.calculator_=e}},{key:"getBatchSizeIE",value:function(){return this.batchSizeIE_}},{key:"setBatchSizeIE",value:function(e){this.batchSizeIE_=e}},{key:"getClusterClass",value:function(){return this.clusterClass_}},{key:"setClusterClass",value:function(e){this.clusterClass_=e}},{key:"getMarkers",value:function(){return this.markers_}},{key:"getTotalMarkers",value:function(){return this.markers_.length}},{key:"getClusters",value:function(){return this.clusters_}},{key:"getTotalClusters",value:function(){return this.clusters_.length}},{key:"addMarker",value:function(e,t){this.pushMarkerTo_(e),t||this.redraw_()}},{key:"addMarkers",value:function(e,t){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&this.pushMarkerTo_(e[i]);t||this.redraw_()}},{key:"pushMarkerTo_",value:function(e){var t=this;e.getDraggable()&&google.maps.event.addListener(e,"dragend",function(){t.ready_&&(e.isAdded=!1,t.repaint())}),e.isAdded=!1,this.markers_.push(e)}},{key:"removeMarker",value:function(e,t){var i=this.removeMarker_(e);return!t&&i&&this.repaint(),i}},{key:"removeMarkers",value:function(e,t){for(var i=!1,n=0;n<e.length;n++){var r=this.removeMarker_(e[n]);i=i||r}return!t&&i&&this.repaint(),i}},{key:"removeMarker_",value:function(e){var t=-1;if(this.markers_.indexOf)t=this.markers_.indexOf(e);else for(var i=0;i<this.markers_.length;i++)if(e===this.markers_[i]){t=i;break}return-1!==t&&(e.setMap(null),this.markers_.splice(t,1),!0)}},{key:"clearMarkers",value:function(){this.resetViewport_(!0),this.markers_=[]}},{key:"repaint",value:function(){var e=this.clusters_.slice();this.clusters_=[],this.resetViewport_(!1),this.redraw_(),setTimeout(function(){for(var t=0;t<e.length;t++)e[t].remove()},0)}},{key:"getExtendedBounds",value:function(e){var t=this.getProjection(),i=new google.maps.LatLng(e.getNorthEast().lat(),e.getNorthEast().lng()),n=new google.maps.LatLng(e.getSouthWest().lat(),e.getSouthWest().lng()),r=t.fromLatLngToDivPixel(i);r.x+=this.gridSize_,r.y-=this.gridSize_;var s=t.fromLatLngToDivPixel(n);s.x-=this.gridSize_,s.y+=this.gridSize_;var a=t.fromDivPixelToLatLng(r),o=t.fromDivPixelToLatLng(s);return e.extend(a),e.extend(o),e}},{key:"redraw_",value:function(){this.createClusters_(0)}},{key:"resetViewport_",value:function(e){for(var t=0;t<this.clusters_.length;t++)this.clusters_[t].remove();this.clusters_=[];for(var i=0;i<this.markers_.length;i++){var n=this.markers_[i];n.isAdded=!1,e&&n.setMap(null)}}},{key:"distanceBetweenPoints_",value:function(e,t){var i=(t.lat()-e.lat())*Math.PI/180,n=(t.lng()-e.lng())*Math.PI/180,r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e.lat()*Math.PI/180)*Math.cos(t.lat()*Math.PI/180)*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371}},{key:"isMarkerInBounds_",value:function(e,t){return t.contains(e.getPosition())}},{key:"addToClosestCluster_",value:function(e){for(var t=4e4,i=null,n=0;n<this.clusters_.length;n++){var r=this.clusters_[n],s=r.getCenter();if(s){var a=this.distanceBetweenPoints_(s,e.getPosition());a<t&&(t=a,i=r)}}if(i&&i.isMarkerInClusterBounds(e))i.addMarker(e);else{var o=new me(this);o.addMarker(e),this.clusters_.push(o)}}},{key:"createClusters_",value:function(e){var t=this;if(this.ready_){var i;0===e&&(google.maps.event.trigger(this,"clusteringbegin",this),void 0!==this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic)),i=this.getMap().getZoom()>3?new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625));for(var n=this.getExtendedBounds(i),r=Math.min(e+this.batchSize_,this.markers_.length),s=e;s<r;s++){var a=this.markers_[s];!a.isAdded&&this.isMarkerInBounds_(a,n)&&(!this.ignoreHidden_||this.ignoreHidden_&&a.getVisible())&&this.addToClosestCluster_(a)}if(r<this.markers_.length)this.timerRefStatic=window.setTimeout(function(){t.createClusters_(r)},0);else{delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this);for(var o=0;o<this.clusters_.length;o++)this.clusters_[o].updateIcon()}}}}],[{key:"CALCULATOR",value:function(e,t){for(var i=0,n=e.length,r=n;0!==r;)r=Math.floor(r/10),i++;return i=Math.min(i,t),{text:n.toString(),index:i,title:""}}},{key:"withDefaultStyle",value:function(e){return Object.assign({textColor:"black",textSize:11,textDecoration:"none",textLineHeight:e.height,fontWeight:"bold",fontStyle:"normal",fontFamily:"Arial,sans-serif",backgroundPosition:"0 0"},e)}}]),i}(pe);be.BATCH_SIZE=2e3,be.BATCH_SIZE_IE=500,be.IMAGE_PATH="../images/m",be.IMAGE_EXTENSION="png",be.IMAGE_SIZES=[53,56,66,78,90];var ye,_e,ke,Se=be,Me=["map"],xe=[{path:"",component:T,canActivateChild:[oe],children:[{path:"",redirectTo:"profile",pathMatch:"full"},{path:"profile",component:ee},{path:"profile/:id",component:he},{path:"map",component:(ye=function(){function t(e,i,n){c(this,t),this.router=e,this.userDataService=i,this.searchUsersService=n,this.searchUsersAround=new m.n,this.currentUser$=this.userDataService.userData,this.foundUsers$=this.searchUsersService.userList$,this.destroyer$=new p.a}return h(t,[{key:"ngAfterViewInit",value:function(){var e=this;this.currentUser$.pipe(Object(Z.a)(this.destroyer$)).subscribe(function(t){t&&e.initMap(t.lat,t.lon)}),this.foundUsers$.subscribe(function(t){e.map&&e.updateMarkers(t)})}},{key:"initMap",value:function(e,t){var i={center:new google.maps.LatLng(e,t),zoom:11,mapTypeId:google.maps.MapTypeId.TERRAIN};this.map=new google.maps.Map(this.mapElement.nativeElement,i),this.initClusterer()}},{key:"updateMarkers",value:function(t){var i=this;this.cleanMarkers(),this.markers=e(t.map(function(e){var t=function(e){var t={url:e.image||B,size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(0,32),scaledSize:new google.maps.Size(32,32)},i={text:e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.email.split("@")[0],color:"#fafafa",className:"label"};return new google.maps.Marker({position:e.lat&&e.lon?{lat:+e.lat,lng:+e.lon}:{lat:50.45466,lng:30.5238},icon:t,shape:{type:"rect"},label:i})}(e);return t.addListener("click",function(){return i.router.navigate(["profile",e.id])}),t})),this.markersClusterer.addMarkers(this.markers)}},{key:"initClusterer",value:function(){this.markersClusterer=new Se(this.map,[],{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"})}},{key:"cleanMarkers",value:function(){this.markersClusterer.clearMarkers()}},{key:"ngOnDestroy",value:function(){this.destroyer$.next()}}]),t}(),ye.\u0275fac=function(e){return new(e||ye)(m.Jb(l.b),m.Jb(V),m.Jb(x))},ye.\u0275cmp=m.Db({type:ye,selectors:[["app-map"]],viewQuery:function(e,t){var i;1&e&&m.tc(Me,!0),2&e&&m.gc(i=m.Wb())&&(t.mapElement=i.first)},outputs:{searchUsersAround:"searchUsersAround"},decls:2,vars:0,consts:[[1,"map"],["map",""]],template:function(e,t){1&e&&m.Kb(0,"div",0,1)},styles:[".map[_ngcontent-%COMP%]{width:80%;height:500px;margin:auto}"],changeDetection:0}),ye)},{path:"list",component:ae}]}],Oe=((_e=function e(){c(this,e)}).\u0275mod=m.Hb({type:_e}),_e.\u0275inj=m.Gb({factory:function(e){return new(e||_e)},imports:[[l.f.forChild(xe)],l.f]}),_e),Ce=s("PCNd"),we=((ke=function e(){c(this,e)}).\u0275mod=m.Hb({type:ke}),ke.\u0275inj=m.Gb({factory:function(e){return new(e||ke)},providers:[G],imports:[[Ce.a,Oe]]}),ke)}}])}();